<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Limbo Hybrid â€“ Homescreen</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 20px;
      background: #000;
      color: #fff;
      font-family: sans-serif;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    .header .title { font-size: 1.2rem; }
    .header .time { font-size: 1rem; color: #ccc; }
    .program-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
      max-width: 600px;
      margin: auto;
    }
    .program-item {
      display: flex;
      align-items: center;
      background: #111;
      border-radius: 12px;
      padding: 10px;
      transition: background 0.3s;
    }
    .program-item:hover { background: #222; }
    .program-name { flex: 1; font-size: 1.1rem; }
    .program-icon {
      width: 48px; height: 48px;
      border-radius: 8px;
      background: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 10px;
      overflow: hidden;
      font-size: 1.2rem;
      color: #fff;
      flex-shrink: 0;
    }
    .program-icon img {
      width: 100%; height: 100%;
      object-fit: cover;
    }
    .program-item button {
      margin-right: 10px;
      padding: 6px 12px;
      background: #fff;
      color: #000;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      flex-shrink: 0;
    }
    .program-item button:hover { background: #ddd; }
    .error-message {
      background: #331; color: #f66;
      padding: 15px; border-radius: 8px;
      margin-top: 20px; border-left: 4px solid #f66;
    }
    .missing-programs {
      background: #331; color: #f66;
      padding: 15px; border-radius: 8px;
      margin-top: 20px; border-left: 4px solid #f66;
    }
    .missing-programs h3 { margin: 0 0 10px; }
  </style>
</head>
<body>
  <div class="header">
    <div class="title">Limbo Hybrid</div>
    <div class="time" id="time">--:--:--</div>
  </div>

  <div class="program-list" id="programList">
    <div class="loading-message">Programme werden geladen...</div>
  </div>

  <script>
    // Programme und ihre Icons (In jedem Ordner /programms/<id>/icon/icon.png)
    const programConfig = {
      clock:       { name: "Clock",       path: "programms/clock/",         icon: "programms/clock/icon/icon.png" },
      Dynamic:     { name: "Dynamic",     path: "programms/Dynamic/",       icon: "programms/Dynamic/icon/icon.png" },
      Storywrighter:{ name: "Storywrighter", path: "programms/Storywrighter/", icon: "programms/Storywrighter/icon/icon.png" },
      "Colorfull Pallets":{ name:"Colorfull Pallets", path:"programms/Colorfull Pallets/", icon:"programms/Colorfull Pallets/icon/icon.png" },
      "Qr-Maker":  { name: "Qr-Maker",    path: "programms/Qr-Maker/",      icon: "programms/Qr-Maker/icon/icon.png" }
    };

    // Uhrzeit
    function updateTime() {
      const now = new Date();
      document.getElementById("time").textContent =
        now.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit",second:"2-digit"});
    }
    updateTime(); setInterval(updateTime,1000);

    // Check Ordner exist (HEAD auf index.html in diesem Ordner)
    async function folderExists(cfg) {
      try {
        const res = await fetch(cfg.path + cfg.name + ".html", { method: "HEAD" });
        return res.ok;
      } catch {
        return false;
      }
    }

    // Laden
    async function loadPrograms() {
      const list = document.getElementById("programList");
      list.innerHTML = "";
      const missing = [];

      for (let id in programConfig) {
        const cfg = programConfig[id];
        if (!await folderExists(cfg)) {
          missing.push(cfg.name + ` (${cfg.path})`);
          continue;
        }
        const item = document.createElement("div");
        item.className = "program-item";

        const btn = document.createElement("button");
        btn.textContent = "Starten";
        btn.onclick = ()=>alert(`Starte ${cfg.name}`);

        const label = document.createElement("div");
        label.className = "program-name";
        label.textContent = cfg.name;

        const iconBox = document.createElement("div");
        iconBox.className = "program-icon";
        const img = new Image();
        img.src = cfg.icon;
        img.onload = ()=>{ iconBox.textContent=""; iconBox.appendChild(img); };
        img.onerror=()=>{ iconBox.textContent=cfg.name.charAt(0); };
        iconBox.textContent = cfg.name.charAt(0);

        item.append(label,btn,iconBox);
        list.appendChild(item);
      }

      if (missing.length) {
        const div = document.createElement("div");
        div.className = "missing-programs";
        div.innerHTML = "<h3>Missing Program Folders</h3><ul>" +
          missing.map(m=>`<li>${m}</li>`).join("") +
          "</ul>";
        list.appendChild(div);
      }
    }

    document.addEventListener("DOMContentLoaded", loadPrograms);
  </script>
</body>
</html>
